<script lang="ts">
	export let repo: string;
	export let sections: Array<{
		slug: string;
		title: string;
		path: string;
		content: string;
	}>;

	import { hydrate } from 'marqua/browser';
	import { version } from 'marqua/package.json';
	import { navigating } from '$app/stores';
	import Edit from './Edit.svelte';
</script>

<main use:hydrate={$navigating}>
	<aside>
		<a
			href="https://github.com/ignatiusmb/marqua/releases/latest"
			style:margin-bottom="0.5rem"
			style:letter-spacing="2px"
			style:font-size="1.25rem"
			style:font-family="var(--font-monospace)"
		>
			v{version}
		</a>

		{#each sections as { slug, title }, i}
			<a href="#{slug}" data-index={`0${i + 1}`.slice(-2)}>{title}</a>
		{/each}
	</aside>

	<article>
		{#each sections as { slug, title, content, path }}
			<section>
				<h2 id={slug}>
					<a href="#{slug}">
						<svg
							width="24"
							height="24"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="1.5"
						>
							<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
							<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
						</svg>
					</a>
					<span>{title}</span>
					<Edit {repo} {path} />
				</h2>

				{@html content}
			</section>
		{/each}
	</article>
</main>

<style>
	main {
		display: grid;
		gap: 2rem;
		grid-template-columns: minmax(0, 1fr);
		align-items: flex-start;
		padding: 0 2rem;
		margin: 2rem auto;
	}

	aside {
		position: sticky;
		top: 0;
		display: none;
		align-content: flex-start;
		padding-top: 2rem;
	}
	aside a {
		line-height: 4ch;
	}
	aside a:not(:first-child):before {
		content: attr(data-index);
		margin-right: 0.75rem;
		font-family: var(--font-monospace);
	}

	article {
		padding-top: 2rem;
	}

	section:not(:first-child) {
		margin-top: 4rem;
		padding-top: 1rem;
		border-top: 0.25rem solid var(--mrq-primary);
	}
	section h2 {
		position: relative;
		display: flex;
		justify-content: space-between;
		margin-bottom: 3rem;
		text-transform: uppercase;
		font-family: var(--font-heading);
		font-size: 2rem;
		font-weight: bold;
	}
	section h2 > a:first-child {
		position: absolute;
		top: 50%;
		left: -0.15rem;
		display: flex;
		transform: translate(-95%, -50%);
		transition: opacity 240ms;
		opacity: 0;
	}
	section h2 > a:first-child:focus,
	section h2:hover > a:first-child {
		opacity: 1;
	}
	section h2 + :global(h3:first-of-type) {
		padding-top: 0;
		margin-top: 0;
		border-top: 0;
	}

	/* @html content */
	section > :global(h3) {
		position: relative;
		display: grid;
		gap: 0.75rem;
		grid-template-columns: 1.25rem auto 1fr;
		align-items: center;
		margin: 2rem 0 1.5rem;
		font-size: 1.5rem;
		font-weight: 500;
	}
	section > :global(h3::before) {
		content: '';
		width: 0.75rem;
		height: 0.75rem;
		border-radius: 50%;
		margin-left: 0.25rem;
		box-shadow: 0 0 0 0.25rem rgba(0, 112, 187, 0.6);
		background-color: var(--mrq-primary);
	}
	section > :global(h3::after) {
		content: '';
		width: 100%;
		height: 0.15rem;
		background-color: rgba(0, 112, 187, 0.6);
	}
	section > :global(p) {
		line-height: 1.5;
	}
	section > :global(p:not(:first-child)) {
		margin-top: 1rem;
	}
	section > :global(ul li:not(:first-child)) {
		margin-top: 0.5rem;
	}
	section :global(.mrq[data-mrq='block']) {
		margin: 1rem 0 1.5rem;
	}

	@media only screen and (min-width: 769px) {
		main {
			grid-template-columns: minmax(12rem, 20%) minmax(0, 60rem);
		}

		aside {
			display: grid;
		}
	}
</style>
